<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Loja de equipamentos do jogo Camadas da Conex√£o. Compre power-ups e melhorias com seus pontos.">
    <title>Loja de Equipamentos - Camadas da Conex√£o</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="stylesheet" href="css/loja-modern.css">
    <link rel="stylesheet" href="css/acessibilidade.css">
    <link href="https://fonts.googleapis.com/css2?family=Kdam+Thmor+Pro&display=swap" rel="stylesheet">
</head>

<body>
    <!-- Controles de Acessibilidade -->
    <div class="accessibility-bar" role="toolbar" aria-label="Controles de acessibilidade">
        <button id="toggle-voice" class="accessibility-btn" aria-label="Ativar ou desativar leitura por voz" title="Leitura por Voz">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3z" stroke="currentColor" stroke-width="2"/>
                <path d="M19 10v2a7 7 0 0 1-14 0v-2M12 19v3M8 22h8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
        </button>
        <button id="increase-font" class="accessibility-btn" aria-label="Aumentar tamanho da fonte" title="Aumentar Fonte">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                <text x="4" y="18" font-size="16" fill="currentColor" font-weight="bold">A+</text>
            </svg>
        </button>
        <button id="decrease-font" class="accessibility-btn" aria-label="Diminuir tamanho da fonte" title="Diminuir Fonte">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                <text x="5" y="18" font-size="14" fill="currentColor" font-weight="bold">A-</text>
            </svg>
        </button>
        <button id="toggle-contrast" class="accessibility-btn" aria-label="Alternar alto contraste" title="Alto Contraste">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                <path d="M12 2v20" stroke="currentColor" stroke-width="2"/>
            </svg>
        </button>
    </div>

    <main class="main-container" role="main">
        <!-- Header da P√°gina -->
        <header class="page-header">
            <div class="header-content">
                <a href="index.html" class="back-btn" aria-label="Voltar ao menu principal">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <path d="M19 12H5M12 19L5 12L12 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>Voltar</span>
                </a>
                
                <div class="header-info">
                    <h1 class="page-title">Loja de Equipamentos</h1>
                    <p class="page-subtitle">Melhore suas habilidades com power-ups especiais</p>
                </div>
                
                <div class="header-stats">
                    <div class="stat-item" role="status" aria-live="polite">
                        <svg width="28" height="28" viewBox="0 0 65 61" fill="none">
                            <path d="M32.5 0L40.0212 23.1479H64.3604L44.6696 37.4541L52.1908 60.6021L32.5 46.2959L12.8092 60.6021L20.3304 37.4541L0.639606 23.1479H24.9788L32.5 0Z" fill="#E1EA2D"/>
                        </svg>
                        <span class="stat-value" id="pontos-display">0</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Filtros da Loja -->
        <section class="filters-section" role="region" aria-label="Filtros da loja">
            <div class="filters-container">
                <button class="filter-btn active" data-filter="todos" aria-pressed="true">
                    Todos
                </button>
                <button class="filter-btn" data-filter="tempo" aria-pressed="false">
                    ‚è±Ô∏è Tempo
                </button>
                <button class="filter-btn" data-filter="bonus" aria-pressed="false">
                    ‚≠ê B√¥nus
                </button>
                <button class="filter-btn" data-filter="ajuda" aria-pressed="false">
                    üí° Ajuda
                </button>
                <button class="filter-btn" data-filter="protecao" aria-pressed="false">
                    üõ°Ô∏è Prote√ß√£o
                </button>
            </div>
        </section>

        <!-- Grid de Itens da Loja -->
        <section class="shop-section" role="region" aria-label="Itens dispon√≠veis para compra">
            <div class="shop-grid" id="shop-grid">
                <!-- Cron√¥metro de Tempo Extra -->
                <article class="shop-card" data-category="tempo" data-item-id="cronometro-tempo-extra" data-voice="Cron√¥metro de Tempo Extra. Adiciona 30 segundos extras para responder cada pergunta. Custa 1200 pontos.">
                    <div class="card-icon">
                        <svg width="60" height="60" viewBox="0 0 24 24" fill="none">
                            <circle cx="12" cy="13" r="8" stroke="#FF6B6B" stroke-width="2.5" fill="none" />
                            <path d="M12 9V13L16 15" stroke="#FF6B6B" stroke-width="2.5" stroke-linecap="round" />
                            <path d="M9 2H15" stroke="#FF6B6B" stroke-width="2.5" stroke-linecap="round" />
                            <path d="M12 2V6" stroke="#FF6B6B" stroke-width="2.5" stroke-linecap="round" />
                        </svg>
                    </div>
                    <div class="card-info">
                        <span class="card-category">Tempo</span>
                        <h2 class="card-title">Cron√¥metro de Tempo Extra</h2>
                        <p class="card-description">Adiciona +30 segundos extras para responder cada pergunta do quiz</p>
                        <div class="card-effects">
                            <span class="effect-badge tempo">‚è±Ô∏è +30s por Pergunta</span>
                        </div>
                    </div>
                    <div class="card-footer">
                        <span class="card-price">
                            <svg viewBox="0 0 65 61" fill="currentColor">
                                <path d="M32.5 0L40.0212 23.1479H64.3604L44.6696 37.4541L52.1908 60.6021L32.5 46.2959L12.8092 60.6021L20.3304 37.4541L0.639606 23.1479H24.9788L32.5 0Z"/>
                            </svg>
                            1200
                        </span>
                        <button class="buy-btn" data-price="1200" data-item="cronometro-tempo-extra" aria-label="Comprar Cron√¥metro de Tempo Extra por 1200 pontos">
                            Comprar
                        </button>
                    </div>
                </article>

                <!-- C√¢mera Lenta -->
                <article class="shop-card" data-category="tempo" data-item-id="camera-lenta" data-voice="C√¢mera Lenta. Faz o tempo passar 50% mais devagar durante perguntas dif√≠ceis. Custa 1800 pontos.">
                    <div class="card-icon">
                        <svg width="60" height="60" viewBox="0 0 24 24" fill="none">
                            <circle cx="12" cy="12" r="10" stroke="#4ECDC4" stroke-width="2.5" fill="none" />
                            <path d="M10 8L16 12L10 16V8Z" fill="#4ECDC4" />
                            <path d="M6 4V8M6 16V20" stroke="#4ECDC4" stroke-width="2.5" stroke-linecap="round" />
                        </svg>
                    </div>
                    <div class="card-info">
                        <span class="card-category">Tempo</span>
                        <h2 class="card-title">C√¢mera Lenta</h2>
                        <p class="card-description">Faz o tempo passar 50% mais devagar durante as perguntas mais dif√≠ceis</p>
                        <div class="card-effects">
                            <span class="effect-badge tempo">üêå Tempo 50% Mais Lento</span>
                        </div>
                    </div>
                    <div class="card-footer">
                        <span class="card-price">
                            <svg viewBox="0 0 65 61" fill="currentColor">
                                <path d="M32.5 0L40.0212 23.1479H64.3604L44.6696 37.4541L52.1908 60.6021L32.5 46.2959L12.8092 60.6021L20.3304 37.4541L0.639606 23.1479H24.9788L32.5 0Z"/>
                            </svg>
                            1800
                        </span>
                        <button class="buy-btn" data-price="1800" data-item="camera-lenta" aria-label="Comprar C√¢mera Lenta por 1800 pontos">
                            Comprar
                        </button>
                    </div>
                </article>

                <!-- Multiplicador de Pontos -->
                <article class="shop-card" data-category="bonus" data-item-id="multiplicador-pontos" data-voice="Multiplicador de Pontos. Dobra os pontos ganhos em todas as perguntas certas. Custa 2000 pontos.">
                    <div class="card-icon">
                        <svg width="60" height="60" viewBox="0 0 24 24" fill="none">
                            <path d="M12 2L15.09 8.26L22 9L17 14L18.18 21L12 17.77L5.82 21L7 14L2 9L8.91 8.26L12 2Z"
                                stroke="#FFD700" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"
                                fill="#FFD700" />
                        </svg>
                    </div>
                    <div class="card-info">
                        <span class="card-category">B√¥nus</span>
                        <h2 class="card-title">Multiplicador de Pontos</h2>
                        <p class="card-description">Dobra os pontos ganhos em todas as perguntas certas do quiz</p>
                        <div class="card-effects">
                            <span class="effect-badge bonus">‚ö° 2x Pontos por Acerto</span>
                        </div>
                    </div>
                    <div class="card-footer">
                        <span class="card-price">
                            <svg viewBox="0 0 65 61" fill="currentColor">
                                <path d="M32.5 0L40.0212 23.1479H64.3604L44.6696 37.4541L52.1908 60.6021L32.5 46.2959L12.8092 60.6021L20.3304 37.4541L0.639606 23.1479H24.9788L32.5 0Z"/>
                            </svg>
                            2000
                        </span>
                        <button class="buy-btn" data-price="2000" data-item="multiplicador-pontos" aria-label="Comprar Multiplicador de Pontos por 2000 pontos">
                            Comprar
                        </button>
                    </div>
                </article>

                <!-- Dica M√°gica -->
                <article class="shop-card" data-category="ajuda" data-item-id="dica-magica" data-voice="Dica M√°gica. Remove uma alternativa errada de cada pergunta. Custa 1500 pontos.">
                    <div class="card-icon">
                        <svg width="60" height="60" viewBox="0 0 24 24" fill="none">
                            <circle cx="12" cy="12" r="10" stroke="#9C27B0" stroke-width="2.5" fill="none" />
                            <path d="M9.09 9A3 3 0 0 1 12 6C13.65 6 15 7.35 15 9C15 11.28 12.5 11 12 13"
                                stroke="#9C27B0" stroke-width="2.5" stroke-linecap="round" />
                            <circle cx="12" cy="17" r="1.5" fill="#9C27B0" />
                        </svg>
                    </div>
                    <div class="card-info">
                        <span class="card-category">Ajuda</span>
                        <h2 class="card-title">Dica M√°gica</h2>
                        <p class="card-description">Remove uma alternativa errada de cada pergunta, facilitando a escolha</p>
                        <div class="card-effects">
                            <span class="effect-badge ajuda">‚ùå Remove 1 Alternativa</span>
                            <span class="effect-badge ajuda">üìà +50% Chance</span>
                        </div>
                    </div>
                    <div class="card-footer">
                        <span class="card-price">
                            <svg viewBox="0 0 65 61" fill="currentColor">
                                <path d="M32.5 0L40.0212 23.1479H64.3604L44.6696 37.4541L52.1908 60.6021L32.5 46.2959L12.8092 60.6021L20.3304 37.4541L0.639606 23.1479H24.9788L32.5 0Z"/>
                            </svg>
                            1500
                        </span>
                        <button class="buy-btn" data-price="1500" data-item="dica-magica" aria-label="Comprar Dica M√°gica por 1500 pontos">
                            Comprar
                        </button>
                    </div>
                </article>

                <!-- Vida Extra -->
                <article class="shop-card" data-category="protecao" data-item-id="vida-extra" data-voice="Vida Extra. Permite errar uma pergunta sem perder pontos. Custa 1000 pontos.">
                    <div class="card-icon">
                        <svg width="60" height="60" viewBox="0 0 24 24" fill="none">
                            <path d="M20.84 4.61A5.5 5.5 0 0 0 16 2A5.5 5.5 0 0 0 12 4A5.5 5.5 0 0 0 8 2A5.5 5.5 0 0 0 3.16 4.61C2.42 5.37 2 6.5 2 8C2 10.78 4.07 16.81 12 22C19.93 16.81 22 10.78 22 8C22 6.5 21.58 5.37 20.84 4.61Z"
                                stroke="#4CAF50" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"
                                fill="#4CAF50" />
                            <path d="M9 12L11 14L15 10" stroke="white" stroke-width="2.5" stroke-linecap="round"
                                stroke-linejoin="round" />
                        </svg>
                    </div>
                    <div class="card-info">
                        <span class="card-category">Prote√ß√£o</span>
                        <h2 class="card-title">Vida Extra</h2>
                        <p class="card-description">Permite errar uma pergunta sem perder pontos ou ser eliminado do quiz</p>
                        <div class="card-effects">
                            <span class="effect-badge protecao">‚ù§Ô∏è 1 Chance Extra</span>
                            <span class="effect-badge protecao">üõ°Ô∏è Sem Penalidade</span>
                        </div>
                    </div>
                    <div class="card-footer">
                        <span class="card-price">
                            <svg viewBox="0 0 65 61" fill="currentColor">
                                <path d="M32.5 0L40.0212 23.1479H64.3604L44.6696 37.4541L52.1908 60.6021L32.5 46.2959L12.8092 60.6021L20.3304 37.4541L0.639606 23.1479H24.9788L32.5 0Z"/>
                            </svg>
                            1000
                        </span>
                        <button class="buy-btn" data-price="1000" data-item="vida-extra" aria-label="Comprar Vida Extra por 1000 pontos">
                            Comprar
                        </button>
                    </div>
                </article>
            </div>
        </section>

        <!-- Equipamentos Ativos -->
        <section class="equipped-section" role="region" aria-label="Equipamentos atualmente equipados">
            <h2 class="section-title">Equipamentos Ativos</h2>
            <div class="equipped-container">
                <div class="equipped-grid" id="equipamentos-container">
                    <div class="no-equipment">
                        <div class="no-equipment-icon">üì¶</div>
                        <p>Nenhum equipamento ativo</p>
                        <p>Compre itens acima para melhorar suas habilidades!</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Live region para an√∫ncios de acessibilidade -->
    <div id="aria-live-region" aria-live="polite" aria-atomic="true" class="sr-only"></div>
    
    <!-- Indicador de Voz Ativa -->
    <div id="voice-indicator" class="voice-indicator" aria-hidden="true">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
            <circle cx="12" cy="12" r="10" fill="currentColor" opacity="0.2"/>
            <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3z" fill="currentColor"/>
        </svg>
        <span>Leitura ativa</span>
    </div>

    <script src="js/path-utils.js"></script>
    <script src="js/voice-accessibility.js"></script>
    <script src="js/global.js"></script>
    <script src="js/audio.js"></script>
    <script src="js/darkmode.js"></script>
    <script>
        // Sistema de loja com LocalStorage
        class LojaManager {
            constructor() {
                this.pontos = parseInt(localStorage.getItem('gamePoints') || '2450');
                this.equipamentosAtivos = JSON.parse(localStorage.getItem('equipamentosAtivos') || '[]');
                this.itensComprados = JSON.parse(localStorage.getItem('itensComprados') || '[]');
                
                this.init();
            }

            init() {
                this.atualizarPontos();
                this.setupFiltros();
                this.setupBotoesCompra();
                this.atualizarVisualizacao();
                this.mostrarEquipamentosAtivos();
            }

            atualizarPontos() {
                const pontosDisplay = document.getElementById('pontos-display');
                if (pontosDisplay) {
                    pontosDisplay.textContent = this.pontos;
                }
            }

            setupFiltros() {
                const filterBtns = document.querySelectorAll('.filter-btn');
                filterBtns.forEach(btn => {
                    btn.addEventListener('click', () => {
                        // Remove active de todos
                        filterBtns.forEach(b => {
                            b.classList.remove('active');
                            b.setAttribute('aria-pressed', 'false');
                        });
                        
                        // Adiciona active no clicado
                        btn.classList.add('active');
                        btn.setAttribute('aria-pressed', 'true');
                        
                        // Reproduz som
                        if (window.audioManager && typeof window.audioManager.playClickSound === 'function') {
                            window.audioManager.playClickSound();
                        }
                        
                        const filtro = btn.getAttribute('data-filter');
                        this.filtrarItens(filtro);
                    });
                });
            }

            filtrarItens(filtro) {
                const cards = document.querySelectorAll('.shop-card');
                cards.forEach(card => {
                    const categoria = card.getAttribute('data-category');
                    if (filtro === 'todos' || categoria === filtro) {
                        card.style.display = 'block';
                        card.style.animation = 'cardSlideIn 0.4s ease-out';
                    } else {
                        card.style.display = 'none';
                    }
                });
            }

            setupBotoesCompra() {
                const buyBtns = document.querySelectorAll('.buy-btn');
                buyBtns.forEach(btn => {
                    btn.addEventListener('click', () => {
                        const preco = parseInt(btn.getAttribute('data-price'));
                        const itemId = btn.getAttribute('data-item');
                        this.comprarItem(itemId, preco, btn);
                    });
                });
            }

            comprarItem(itemId, preco, btn) {
                // Verificar se j√° foi comprado
                if (this.itensComprados.includes(itemId)) {
                    this.mostrarMensagem('Voc√™ j√° possui este equipamento!', 'info');
                    return;
                }

                // Verificar pontos
                if (this.pontos < preco) {
                    this.mostrarMensagem('Pontos insuficientes!', 'error');
                    if (window.audioManager && typeof window.audioManager.playErrorSound === 'function') {
                        window.audioManager.playErrorSound();
                    }
                    return;
                }

                // Realizar compra
                this.pontos -= preco;
                this.itensComprados.push(itemId);
                this.equipamentosAtivos.push(itemId);

                // Salvar no localStorage
                localStorage.setItem('gamePoints', this.pontos.toString());
                localStorage.setItem('itensComprados', JSON.stringify(this.itensComprados));
                localStorage.setItem('equipamentosAtivos', JSON.stringify(this.equipamentosAtivos));

                // Atualizar interface
                this.atualizarPontos();
                this.atualizarVisualizacao();
                this.mostrarEquipamentosAtivos();

                // Feedback
                this.mostrarMensagem('Equipamento comprado com sucesso!', 'success');
                if (window.audioManager && typeof window.audioManager.playSuccessSound === 'function') {
                    window.audioManager.playSuccessSound();
                }

                // Marcar card como comprado
                const card = btn.closest('.shop-card');
                if (card) {
                    card.classList.add('purchased');
                    btn.disabled = true;
                    btn.textContent = 'Comprado';
                }
            }

            atualizarVisualizacao() {
                const cards = document.querySelectorAll('.shop-card');
                cards.forEach(card => {
                    const itemId = card.getAttribute('data-item-id');
                    const btn = card.querySelector('.buy-btn');
                    
                    if (this.itensComprados.includes(itemId)) {
                        card.classList.add('purchased');
                        if (btn) {
                            btn.disabled = true;
                            btn.textContent = 'Comprado';
                        }
                    }
                });
            }

            mostrarEquipamentosAtivos() {
                const container = document.getElementById('equipamentos-container');
                if (!container) return;

                if (this.equipamentosAtivos.length === 0) {
                    container.innerHTML = `
                        <div class="no-equipment">
                            <div class="no-equipment-icon">üì¶</div>
                            <p>Nenhum equipamento ativo</p>
                            <p>Compre itens acima para melhorar suas habilidades!</p>
                        </div>
                    `;
                    return;
                }

                // Mapeamento de itens
                const itensInfo = {
                    'cronometro-tempo-extra': {
                        nome: 'Cron√¥metro de Tempo Extra',
                        descricao: '+30s por pergunta',
                        preco: 1200,
                        categoria: 'tempo'
                    },
                    'camera-lenta': {
                        nome: 'C√¢mera Lenta',
                        descricao: 'Tempo 50% mais lento',
                        preco: 1800,
                        categoria: 'tempo'
                    },
                    'multiplicador-pontos': {
                        nome: 'Multiplicador de Pontos',
                        descricao: '2x pontos por acerto',
                        preco: 2000,
                        categoria: 'bonus'
                    },
                    'dica-magica': {
                        nome: 'Dica M√°gica',
                        descricao: 'Remove 1 alternativa errada',
                        preco: 1500,
                        categoria: 'ajuda'
                    },
                    'vida-extra': {
                        nome: 'Vida Extra',
                        descricao: '1 chance extra sem penalidade',
                        preco: 1000,
                        categoria: 'protecao'
                    }
                };

                container.innerHTML = this.equipamentosAtivos.map(itemId => {
                    const info = itensInfo[itemId];
                    if (!info) return '';
                    
                    return `
                        <div class="equipped-card" data-item-id="${itemId}">
                            <div class="equipped-header">
                                <h3 class="equipped-name">${info.nome}</h3>
                                <button class="unequip-btn" data-item="${itemId}" aria-label="Remover ${info.nome}" title="Remover equipamento">
                                    √ó
                                </button>
                            </div>
                            <p class="equipped-description">${info.descricao}</p>
                            <div class="equipped-footer">
                                <span class="equipped-price">${info.preco} pontos</span>
                                <span class="equipped-status">‚úì Ativo</span>
                            </div>
                        </div>
                    `;
                }).join('');

                // Setup bot√µes de remover
                const unequipBtns = container.querySelectorAll('.unequip-btn');
                unequipBtns.forEach(btn => {
                    btn.addEventListener('click', () => {
                        const itemId = btn.getAttribute('data-item');
                        this.removerEquipamento(itemId);
                    });
                });
            }

            removerEquipamento(itemId) {
                const index = this.equipamentosAtivos.indexOf(itemId);
                if (index > -1) {
                    this.equipamentosAtivos.splice(index, 1);
                    localStorage.setItem('equipamentosAtivos', JSON.stringify(this.equipamentosAtivos));
                    this.mostrarEquipamentosAtivos();
                    this.mostrarMensagem('Equipamento removido!', 'info');
                    
                    if (window.audioManager && typeof window.audioManager.playClickSound === 'function') {
                        window.audioManager.playClickSound();
                    }
                }
            }

            mostrarMensagem(texto, tipo = 'info') {
                const ariaLive = document.getElementById('aria-live-region');
                if (ariaLive) {
                    ariaLive.textContent = texto;
                }

                // Criar mensagem visual
                const msg = document.createElement('div');
                msg.className = `shop-message ${tipo}`;
                msg.textContent = texto;
                msg.style.cssText = `
                    position: fixed;
                    top: 100px;
                    right: 20px;
                    padding: 1rem 2rem;
                    border-radius: 50px;
                    font-weight: 600;
                    z-index: 1000;
                    animation: slideInRight 0.3s ease-out;
                    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
                `;

                if (tipo === 'success') {
                    msg.style.background = 'linear-gradient(135deg, #4CAF50, #66BB6A)';
                    msg.style.color = 'white';
                } else if (tipo === 'error') {
                    msg.style.background = 'linear-gradient(135deg, #ff4757, #ff3838)';
                    msg.style.color = 'white';
                } else {
                    msg.style.background = 'linear-gradient(135deg, #0DF, #00a8cc)';
                    msg.style.color = 'white';
                }

                document.body.appendChild(msg);

                setTimeout(() => {
                    msg.style.animation = 'fadeOut 0.3s ease-out';
                    setTimeout(() => msg.remove(), 300);
                }, 3000);
            }
        }

        // Inicializar quando DOM carregar
        document.addEventListener('DOMContentLoaded', () => {
            window.lojaManager = new LojaManager();
        });

        // Anima√ß√£o CSS
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideInRight {
                from {
                    opacity: 0;
                    transform: translateX(100px);
                }
                to {
                    opacity: 1;
                    transform: translateX(0);
                }
            }
            @keyframes fadeOut {
                to {
                    opacity: 0;
                    transform: translateX(100px);
                }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>

</html>